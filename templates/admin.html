
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournament Setup</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container admin-container">
        <h1>Tournament Setup</h1>
        
        <form id="tournament-form">
            <div class="form-group">
                <label for="tournament-name">Tournament Name:</label>
                <input type="text" id="tournament-name" required>
            </div>
            
            <h2>Blind Structure</h2>
            <div id="levels-container">
                <!-- Levels will be added here dynamically -->
            </div>
            
            <button type="button" id="add-level-btn" class="btn">Add Level</button>
            
            <div class="form-actions">
                <button type="submit" class="btn">Save Tournament</button>
                <a href="/" class="btn">Cancel</a>
            </div>
        </form>
    </div>

    <script>
        // Tournament data
        let tournamentData = {{ tournament|tojson|safe }};
        
        // Elements
        const tournamentNameInput = document.getElementById('tournament-name');
        const levelsContainer = document.getElementById('levels-container');
        const addLevelBtn = document.getElementById('add-level-btn');
        const form = document.getElementById('tournament-form');
        
        // Load existing data
        function loadTournamentData() {
            tournamentNameInput.value = tournamentData.name;
            
            // Clear existing levels
            levelsContainer.innerHTML = '';
            
            // Add each level
            tournamentData.levels.forEach((level, index) => {
                addLevelRow(level, index);
            });
        }
        
        // Add a new level row
        function addLevelRow(level = {}, index) {
            const levelNumber = level.level || (tournamentData.levels.length + 1);
            const smallBlind = level.small_blind || 0;
            const bigBlind = level.big_blind || 0;
            const ante = level.ante || 0;
            const duration = level.duration || 15;
            
            const levelRow = document.createElement('div');
            levelRow.className = 'level-row';
            levelRow.innerHTML = `
                <div class="level-number">Level ${levelNumber}</div>
                <div class="level-inputs">
                    <div class="form-group">
                        <label for="small-blind-${index}">Small Blind:</label>
                        <input type="number" id="small-blind-${index}" value="${smallBlind}" min="1" required>
                    </div>
                    <div class="form-group">
                        <label for="big-blind-${index}">Big Blind:</label>
                        <input type="number" id="big-blind-${index}" value="${bigBlind}" min="2" required>
                    </div>
                    <div class="form-group">
                        <label for="ante-${index}">Ante:</label>
                        <input type="number" id="ante-${index}" value="${ante}" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="duration-${index}">Duration (min):</label>
                        <input type="number" id="duration-${index}" value="${duration}" min="1" required>
                    </div>
                    <button type="button" class="btn remove-btn" data-index="${index}">Remove</button>
                </div>
            `;
            
            levelsContainer.appendChild(levelRow);
        }
        
        // Add event listeners for remove buttons
        function addRemoveListeners() {
            document.querySelectorAll('.remove-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    e.target.closest('.level-row').remove();
                    
                    // Renumber remaining levels
                    updateLevelNumbers();
                });
            });
        }
        
        // Update level numbers
        function updateLevelNumbers() {
            document.querySelectorAll('.level-row').forEach((row, index) => {
                row.querySelector('.level-number').textContent = `Level ${index + 1}`;
                row.querySelector('.remove-btn').dataset.index = index;
            });
        }
        
        // Save tournament data
        function saveTournamentData() {
            const levels = [];
            
            document.querySelectorAll('.level-row').forEach((row, index) => {
                const level = {
                    level: index + 1,
                    small_blind: parseInt(row.querySelector(`input[id^="small-blind-"]`).value),
                    big_blind: parseInt(row.querySelector(`input[id^="big-blind-"]`).value),
                    ante: parseInt(row.querySelector(`input[id^="ante-"]`).value),
                    duration: parseInt(row.querySelector(`input[id^="duration-"]`).value)
                };
                
                levels.push(level);
            });
            
            const updatedTournament = {
                name: tournamentNameInput.value,
                levels: levels
            };
            
            // Send to server
            fetch('/api/tournament', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(updatedTournament)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    window.location.href = '/';
                }
            })
            .catch(error => {
                console.error('Error saving tournament:', error);
                alert('Error saving tournament. Please try again.');
            });
        }
        
        // Event listeners
        addLevelBtn.addEventListener('click', () => {
            addLevelRow({}, document.querySelectorAll('.level-row').length);
            addRemoveListeners();
        });
        
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            saveTournamentData();
        });
        
        // Initialize
        loadTournamentData();
        addRemoveListeners();
    </script>
</body>
</html>
